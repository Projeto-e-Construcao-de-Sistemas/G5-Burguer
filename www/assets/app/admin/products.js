(function(root,factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory)}else if(root.mainApp.controller){root.mainApp.controller.module=factory(mainApp.controller,window.jQuery||window.$)}else if(root.mainApp){root.mainApp.controller=factory(mainApp,window.jQuery||window.$)}else{console.error('Main application was not loaded')}}(typeof self!=='undefined'?self:this,function(parent,$){'use strict';const NO_IMAGE='https://via.placeholder.com/400?text=sem+foto';const dataModel={'id':0,'type':0,'situation':0,'name':'','description':'','price':0,'name':'','url':''};const dataConv={'price':val=>val===null?0:parseFloat(val),'type':val=>parseInt(val,10),'situation':val=>parseInt(val,10),'description':val=>val||'','name':val=>val||'',};const inpId=$('#record-id');const IN_STOCK='0';const TYPE_EXTERNAL='external';let currentRecord=$.objectNormalizer(dataModel,dataModel);const buildPayload=()=>{return{}};const callSpecialMethod=(command,message)=>{mainApp.ajax({url:`products/${currentRecord.id}/${command}`,method:'PUT',dataType:'json',success:result=>{setRecord(result);fillEditForm();history.back();$.success(`Produto ${message} com sucesso.`)},error:()=>history.back()})};const fillEditForm=()=>{inpId.text(currentRecord.id||'0')};const numberFormat=(number,precision)=>{return $.number(number,precision,',','.')};const resetRecord=function(){setRecord(dataModel)};const setRecord=data=>{currentRecord=$.objectNormalizer(data,dataModel,dataConv)};$.inputNumber();const getRecord=(rowId,callback)=>{mainApp.ajax({url:`products/${rowId}`,method:'GET',data:{},success:result=>{setRecord(result);callback()},error:()=>{location.hash=''}})};return{currentRecord:()=>currentRecord,dataTableObj:{ajax:{url:'products',method:'GET',},columns:[{data:'situation',className:'text-center text-nowrap',width:'1%',render:parent.productSituationIcon},{data:'type',className:'text-nowrap',render:parent.orderSituationText},{data:'name',className:'text-nowrap',render:(data,type,row)=>{if(type!=='display'){return data}
return htmlLink({href:`#${row.id}`,text:data||'[ produto sem nome ]'})}},{data:'price',orderable:!1,className:'text-right text-nowrap',render:(data,type)=>{if(type!=='display'){return data}
return $.brlFormat(data)},}],order:[],stateSave:!1},fillDetails:fillEditForm,formChangeInspect:()=>{const original=$.objectNormalizer(currentRecord,currentRecord);const payload=$.objectNormalizer(buildPayload(),currentRecord,dataConv);return!Object.isSimilar(original,payload)},formSave:()=>{const payload=buildPayload();mainApp.ajax({url:'products'+(currentRecord.id?'/'+currentRecord.id:''),method:currentRecord.id?'PUT':'POST',data:Object.assign({},payload,{}),dataType:'json',success:result=>{setRecord(result);fillEditForm();$('#tab-log').find('table.dataTable').DataTable().draw();$.success('Produto salvo com sucesso.')}})},getRecord:getRecord,resetRecord:resetRecord,init:()=>{fillEditForm()},}}))