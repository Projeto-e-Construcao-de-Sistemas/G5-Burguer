(function(root,factory){if(typeof define==='function'&&define.amd){define(['root','jquery'],factory)}else if(root.mainApp){root.mainApp.controller=factory(root,root.mainApp,window.jQuery||window.$)}else{console.error('Main application was not loaded')}}(typeof self!=='undefined'?self:this,function(root,parent,$){'use strict';const dataTablesObj={autoWidth:!1,columns:[],deferLoading:0,deferRender:!0,dom:'<"row"<"col-sm-12"tr>><"row"<"col-xs-12 text-center"i>><"row"<"col-sm-6"l><"col-sm-6"p>>',language:parent.dataTablesTranslation('pt-BR'),order:[],pagingType:'numbers',processing:!1,scrollX:!0,scrollCollapse:!0,serverSide:!0,stateDuration:3600,stateSave:!1};const iconBugClassName='fa-bug text-gray';let jconfirm=null;let resizeTimeout;const aLinkString=element=>{const link=document.createElement('a');$(link).attr({'href':element.href,'title':element.title?element.title:element.text,'data-toggle':'tooltop','target':element.target?element.target:''}).html(element.text);return link.outerHTML};const decision=(value,conditions,defValue)=>{if(typeof defValue==='undefined'){defValue='n/a'}
if(typeof conditions[value]==='undefined'){return defValue}
return conditions[value]};const formContentChange=(fields,silent)=>{const form=$('[data-window="form"]');let hasChange=Array.isArray(fields)?fields.find(field=>{const original=field[0]||'';const value=field[1]||'';return(original!==value)}):fields;if(form.length&&form.is(':visible')){if(hasChange&&!silent){hasChange=!confirm('As alterações não foram salvas.\n\nDeseja continuar?')}
return!(!hasChange)}
return!1};const hideConfirmDialog=()=>{if(jconfirm){jconfirm.close();jconfirm=null}};const htmlIcon=properties=>{const icon=document.createElement('i');$(icon).addClass('fa').addClass(properties.className).attr({'title':properties.title,'data-toggle':'tooltip'});return icon.outerHTML};const messageSituationIcon=function(situation){return htmlIcon({title:messageSituationText(situation),className:decision(parseInt(situation,10),{0:'fa-question text-gray',1:'fa-thumbs-o-up text-success',2:'fa-quote-left text-warning',3:'fa-thumbs-o-down text-danger',4:'fa-hand-paper-o text-gray'},iconBugClassName)})};const messageSituationText=function(situation){return decision(parseInt(situation,10),{0:'Pendente',1:'Aprovada',2:'Moderada',3:'Recusada',4:'Ignorada'})};const moduleDone=module=>{if(typeof module!=='object'||typeof module.ready!=='function'){return}
module.ready()};const moduleInit=(module,parameters)=>{if(typeof module!=='object'||typeof module.init!=='function'){return}
module.init(parameters)};const normalizeDTObj=data=>{const dtObj=$.normalizeData(dataTablesObj,data);if(typeof dtObj.ajax==='object'&&dtObj.ajax!==null&&typeof dtObj.ajax.url==='string'){dtObj.ajax.url=restfulUrl(dtObj.ajax.url)}
return dtObj};const normalizeS2Obj=(data,url,processor,filter)=>{const ajaxData=params=>{return{'filter':typeof filter==='function'?filter(params.term):{'name':params.term,},'start':((params.page||1)-1)*10,'length':10}};const defObj={allowClear:!0,language:'pt-BR',minimumInputLength:3,placeholder:'Clique para selecionar',closeOnSelect:!1,theme:'bootstrap',ajax:url?{url:url,method:'GET',delay:250,data:ajaxData,processResults:(result,params)=>{let rows=[];params.page=params.page||1;result.data.forEach(row=>{rows.push(typeof processor==='function'?processor(row):{id:row.id,text:row.name,disabled:!1})});return{results:rows,pagination:{more:(params.page*10)<result.recordsTotal}}},cache:!0}:null,};const s2Obj=$.normalizeData(defObj,data);if(typeof s2Obj.ajax==='object'&&s2Obj.ajax!==null&&typeof s2Obj.ajax.url==='string'){s2Obj.ajax.url=restfulUrl(s2Obj.ajax.url)}
return s2Obj};const orderItemSituationIcon=function(status){return htmlIcon({title:orderItemSituationText(status),className:decision(status,{'1':'fa-clock-o text-gray','2':'fa-cog fa-spin text-green','3':'fa-truck text-light-blue','4':'fa-check-square-o text-green','5':'fa-truck fa-flip-horizontal text-orange','6':'fa-undo text-danger','7':'fa-times text-red',},iconBugClassName)})};const orderItemSituationText=function(status){return decision(status,{'1':'Aguardando aprovação','2':'Aprovado/Em preparação','3':'A caminho','4':'Entregue','5':'Retornando','6':'Devolvido','7':'Cancelado',})};const orderReferralIcon=status=>{return htmlIcon({title:orderReferralText(status),className:decision(status,{'0':'fa-shopping-cart text-yellow','1':'fa-graduation-cap text-danger','2':'fa-glass text-fuchsia','3':'fa-briefcase text-olive','4':'fa-university text-aqua',},iconBugClassName)})};const orderReferralText=status=>{return decision(status,{'0':'Marketplace','3':'Orçamento',})};const orderSituationIcon=status=>{return htmlIcon({title:orderSituationText(status),className:decision(status,{'1':'fa-clock-o text-gray','2':'fa-thumbs-o-up text-green','3':'fa-check-square-o text-green','4':'fa-times text-red',},iconBugClassName)})};const orderSituationText=status=>{return decision(status,{'1':'Lanche','2':'Acompanhamento','3':'Bebida',})};const personUserHyperlink=function(user,store){if(store.id){return aLinkString({href:'/stores#'+store.id,text:store.name})}
return aLinkString({href:'/users#'+user.id,text:user.name})};const productSituationIcon=function(situation){return htmlIcon({title:productSituationText(situation),className:decision(parseInt(situation,10),{0:'fa-fw fa-eye-slash text-gray',1:'fa-fw fa-eye text-green',2:'fa-fw fa-unlink text-warning',3:'fa-fw fa-trash text-red',4:'fa-fw fa-ban text-danger',5:'fa-fw fa-eye-slash text-gray',},iconBugClassName)})};const productSituationText=function(situation){return decision(parseInt(situation,10),{0:'Inativo',1:'Ativo',})};const purchaseOrderSituationIcon=status=>{return htmlIcon({title:purchaseOrderSituationText(status),className:decision(status,{'1':'fa-clock-o text-gray','2':'fa-thumbs-o-up text-green','3':'fa-industry text-green','4':'fa-times text-red',},iconBugClassName)})};const purchaseOrderSituationText=status=>{return decision(status,{'1':'Aguardando aprovação','2':'Aprovada','3':'Requerida','4':'Cancelada',})};const resizeThrottler=()=>{if(!resizeTimeout){resizeTimeout=setTimeout(()=>{resizeTimeout=null;$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},66)}};const rowAction=action=>{if(action.href){return rowActionLink(action)}
return rowActionSpacer(action)};const rowActionLink=action=>{const button=document.createElement('a');const icon=document.createElement('i');button.className='btn btn-default btn-xs';button.append(icon);icon.className=`fa fa-${action.icon}`;$(button).attr({'href':action.href,'title':action.title,'data-toggle':'tooltip','data-placement':action.placement||'top'});if(action.className){$(button).addClass(action.className)}
if(action.target){$(button).attr('target',action.target)}
if(action.disabled){$(button).addClass('disabled').attr('disabled',!0)}
return button};const rowActionSpacer=action=>{const spacer=document.createElement('div');spacer.style='display:'+(action.display||'inline-block')+';width:'+(action.width||'4px')+';height:'+(action.height||'4px');return spacer};const rowActions=(actions,spacer=!0)=>{let buttons='';actions.forEach(action=>{const button=rowAction(action);buttons+=button.outerHTML+(spacer?rowActionSpacer({}).outerHTML:'')});return buttons.trim()};const showConfirmDialog=parameters=>{jconfirm=$.confirm(parameters)};const stringToSlug=function(str){const from='àáâãåäªèéëêÆæìíïîòóöôõºðŒØøœùúüûµÑñç¢Ð£ßŠ§šýÿ¥ž¹²³·/_,:;';const to='aaaaaaaeeeeeeiiiiooooooooooouuuuunnccdlssssyyyz123------';str=str.replace(/^\s+|\s+$/g,'');str=str.toLowerCase();$.each(from.split(''),index=>{str=str.replace(new RegExp(from.charAt(index),'g'),to.charAt(index))});str=str.replace(/[^a-z0-9 -]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-');return str};$.switchWindow=name=>{const windows=$(`[data-window="${name}"]`);const others=$(`[data-window][data-window!="${name}"]`);hideConfirmDialog();$('.sidebar-form').find('input').val('');if(windows.length){windows.addClass('active');$(`[data-menu="${name}"]`).show()}
if(others.length){others.removeClass('active');$(`[data-menu][data-menu!="${name}"]`).hide()}
resizeThrottler();return windows};root.decision=decision;root.htmlIcon=htmlIcon;root.htmlLink=aLinkString;root.stringToSlug=stringToSlug;parent.slideToTop();$('.with-toobar .navbar-static-top .navbar-collapse').on('click','a',function(){if($(this).hasClass('dropdown-toggle')){return}
$(this).parents('.navbar-collapse').collapse('hide')});$.confirmAction=(actions={},action='')=>{const options=actions[action]||{};$.confirmDialog(options)};$.confirmDialog=(options={})=>{const cancel=(Object.prototype.hasOwnProperty.call(options,'cancel')&&(options.cancel instanceof Function))?options.cancel:()=>history.back();const yesLbl=options.confirmText||'Sim';const noLbl=options.cancelText||'Não';if(!Object.prototype.hasOwnProperty.call(options,'action')||!(options.action instanceof Function)){location.hash='';return}
showConfirmDialog({title:options.title,content:options.content,icon:'fa fa-question',theme:'modern',buttons:{yes:{text:yesLbl,btnClass:'btn-success',action:options.action,},no:{text:noLbl,btnClass:'btn-danger',action:cancel,}}})};$.formatBrazilianDocument=value=>{const docnumber=value.replace(/\D/g,'');if(docnumber.length===11){return docnumber.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g,'$1.$2.$3-$4')}
if(docnumber.length!==14){return docnumber}
return docnumber.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g,'$1.$2.$3/$4-$5')};$.hasAdmModule=(module,action)=>{return!(!admModules[module]||!admModules[module].includes(action))};$.error=message=>{const options={text:message,duration:3000,gravity:'bottom',position:'center',className:'bg-red-gradient',stopOnFocus:!0,onClick:()=>{toast.hideToast()}};let toast;toast=Toastify(options).showToast()};$.success=message=>{const options={text:message,duration:3000,gravity:'bottom',position:'center',className:'bg-green-gradient',stopOnFocus:!0,onClick:()=>{toast.hideToast()}};let toast;toast=Toastify(options).showToast()};Object.isSimilar=(obj1,obj2)=>{for(var p in obj1){if(Object.prototype.hasOwnProperty.call(obj1,p)!==Object.prototype.hasOwnProperty.call(obj2,p)){continue}
if(typeof obj1[p]!==typeof obj2[p]){console.warn(`${p} typeof mismatch`);return!1}
switch(typeof(obj1[p])){case 'object':if(Array.isArray(obj1[p])&&obj1[p].length!=obj2[p].length){console.warn(`${p} array length mismatch`);return!1}else if(!Object.isSimilar(obj1[p],obj2[p])){console.warn(`${p} objects mismatch`);return!1}
break;case 'function':if(typeof(obj2[p])=='undefined'||(p!='compare'&&obj1[p].toString()!=obj2[p].toString())){console.warn(`${p} functions mismatch`);return!1}
break;default:if(obj1[p]!=obj2[p]){console.warn(`${p} values mismatch. ${obj1[p]} != ${obj2[p]}`);return!1}}}
return!0};$.fn.dataTable.ext.errMode=(e,settings,techNote,message)=>{parent.showError('Ocorreu um erro ao recuperar os dados da tabela.<br><br>Mensagem de erro: '+message+'<br><br>Nota técnica: '+techNote)};$(document).on('expanded.pushMenu',resizeThrottler);$(document).on('collapsed.pushMenu',resizeThrottler);window.addEventListener('resize',resizeThrottler,!1);new ResizeObserver(resizeThrottler).observe(document.querySelector('.main-sidebar'));$.fn.extend({brazilianDocInputMask:function(options={}){return $(this).inputmask($.objectNormalizer(options,{mask:['999.999.999-99','99.999.999/9999-99'],greedy:!1,clearIncomplete:!0,autoUnmask:!0,onBeforePaste:pastedValue=>{return pastedValue.replace(/\D/g,'')}})).on('focus',function(){$(this).select()})},setDataTable:function(options){return $(this).DataTable(normalizeDTObj(options))},setSelect2:function(options,url=!1,processor=!1,filter=!1){return $(this).select2(normalizeS2Obj(options,url,processor,filter))},setSelectUser:function(filter=!1,options={closeOnSelect:!0}){return $(this).setSelect2($.normalizeData({templateResult:data=>{if(!data.id){return data.text}
return $(`<span>${data.text} - <small>${data.email}</small></span>`)}},options),'users',row=>{return{id:row.id,text:row.name,email:row.email,disabled:!1}},filter)},valBRL:function(options){const $this=$(this);$this.val('R$ '+$.number(options,2,',','.'));return $this},valDateTime:function(options){const $this=$(this);$this.val(parent.formatDateTime(options));return $this},});return{init:function(options){if(!options.module){return}
$.cachedScript(options.module).done(()=>{moduleInit(this.module,options.parameters);if(typeof this.module.actions!=='object'){this.module.actions={}}
if(typeof this.module.formChangeInspect==='function'){this.module.checkFormChange=(silent)=>{return formContentChange(this.module.formChangeInspect(),silent)}}
this.initDataTable();this.initGetHash();if(this.module.checkFormChange){window.addEventListener('beforeunload',event=>{if(this.module.checkFormChange(!0)){event.preventDefault();event.returnValue=''}});window.addEventListener('popstate',()=>{if(this.module.checkFormChange(!1)){history.pushState(null,document.title,document.body.getAttribute('data-hash'))}})}
checkAnchor();moduleDone(this.module)})},module:{init:()=>{console.error('No modules has been loaded!')}},dataTable:null,getRecordExp:/^#([\w]+|new)(.*)?$/,getRecordIdx:1,hashDetailsExp:/^#([0-9]+|new)(\/(.*))?$/,hashSubCommand:/^([\w-]+)((:([0-9]+|new))?(\/.*)?)?$/,recordIdExp:/^[0-9]+$/,permatab:!1,initDataTable:function(){const filterForm=$('form[role="filter"]');const sidebarForm=$('.sidebar-form');const dtElm=$(this.module.dataTableEl||'#dataTable');const lstElm=this.module.lstElm||'#list-box';const refreshBtn=$('a[href="#refresh"]');const nullFunc=()=>null;const applyFilter=form=>{const action=form.attr('action');const box=$(form.data('target'));hideFilterBox(box);if(action&&typeof this.module[action]==='function'){this.module[action]();return}
if($('.area-table').is(':visible')||$('[data-window="table"]').is(':visible')){this.dataTable.draw();return}
location.hash=''};const hideFilterBox=box=>{const menu=box.parents('.filter-menu');if(menu.length){menu.removeClass('open')}};const resetFilter=form=>{this.module.resetFilter(form)};const canFilter=()=>{return this.module.canFilter()};const switchFilterNotice=notice=>{if(notice.length){notice.toggleClass('hidden',!this.module.isFiltering(notice))}};if(typeof this.module.resetRecord!=='function'){this.module.resetRecord=nullFunc}
if(typeof this.module.resetFilter!=='function'){this.module.resetFilter=nullFunc}
if(typeof this.module.isFiltering!=='function'){this.module.isFiltering=()=>!1}
if(typeof this.module.canFilter!=='function'){this.module.canFilter=()=>!0}
if(typeof this.module.sidebarSearchForm!=='function'){this.module.sidebarSearchForm=()=>!1}
if(typeof this.module.dataTableObj!=='undefined'){if(!dtElm.data('notice')){dtElm.attr('data-notice','#filtering-notice')}
this.dataTable=dtElm.setDataTable(this.module.dataTableObj).on('draw',(e)=>{const refBtn=$(`a[href="#refresh"][data-target="#${e.target.id}"]`);if(refBtn.length){refreshBtn.find('.fa-refresh').removeClass('fa-pulse')}
deleteOverlay(lstElm);$('[data-toggle="tooltip"]').tooltip();if(e.target.dataset.notice){switchFilterNotice($(e.target.dataset.notice))}}).on('processing',(e,settings,processing)=>{const refBtn=$(`a[href="#refresh"][data-target="#${e.target.id}"]`);if(processing){addOverlay(lstElm);if(refBtn.length){refBtn.find('.fa-refresh').addClass('fa-pulse')}}});parent.registerHash('',()=>{this.permatab=!1;this.module.resetRecord();$.switchWindow('table');this.dataTable.draw('page')})}
if(refreshBtn.length){refreshBtn.each(function(){const $this=$(this);const defaultId=dtElm.attr('id');if(!$this.data('target')){$this.attr('data-target',`#${defaultId}`)}});refreshBtn.on('click',function(evt){const target=$($(this).data('target'));evt.preventDefault();target.DataTable().draw()})}
if(filterForm.length){filterForm.on('submit',function(evt){const form=$(this);evt.preventDefault();if(canFilter()){applyFilter(form)}});$('[data-filter-clear]').click(function(evt){const box=$($(this).data('filter-clear'));const form=box.find('form');evt.preventDefault();form.get(0).reset();resetFilter(form);applyFilter(form)});$(document).on('click','.select2-results__option, .select2-selection__choice__remove, .select2-search, .daterangepicker.ltr>*',()=>{return!1})}
if(sidebarForm.length){sidebarForm.submit(evt=>{const inputField=sidebarForm.find('input');const search=inputField.val();evt.preventDefault();inputField.val('');$('body').removeClass('sidebar-open');if(!search){return}
if(this.recordIdExp.test(search)){location.hash=search;return}
if(this.module.sidebarSearchForm(search)){applyFilter(filterForm)}})}},initGetHash:function(){const windows=$('[data-window="form"]');const checkFormChange=this.module.checkFormChange;const formSave=this.module.formSave;if((typeof this.module.getRecord!=='function')||(typeof this.module.currentRecord==='undefined')||(this.dataTable===null)||(typeof this.module.fillDetails!=='function')||(typeof this.module.resetRecord!=='function')){return}
parent.registerHash(this.getRecordExp,match=>{const recId=match[this.getRecordIdx];if(!recId){location.hash='';return}
if(recId===this.module.currentRecord().id){this.showDetails(!1);return}
if(recId.match(/^(0|new)$/)){this.module.resetRecord();this.showDetails(!0);return}
this.module.getRecord(recId,()=>{this.showDetails(!0)})});$('a[data-toggle="tab"]').on('shown.bs.tab',evt=>{const href=$(evt.target).attr('href');const table=$(href).find('table.dataTable');if(table.length){const dtable=table.DataTable();const body=dtable.table().body();if(body.className=='MR'){body.className='';dtable.draw()}}
$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()});if(!windows.length||typeof formSave!=='function'){return}
const submitForm=()=>{if(!checkFormChange(!0)){$.error('Nenhuma alteração para salvar.');return!1}
return formSave()};windows.on('submit','form',evt=>{evt.preventDefault();return submitForm()});windows.on('click','[data-save="form"]',function(evt){const $this=$(this);evt.preventDefault();if($this.hasClass('disabled')){return!1}
return submitForm()})},showDetails:function(redraw=!0){const recId=this.module.currentRecord().id||'new';const match=window.location.hash.match(this.hashDetailsExp)||[];const method=match[3]||'';const forms=$.switchWindow('form');document.body.setAttribute('data-hash',location.hash);const recordCommand=(expression)=>{const match=expression.match(this.hashSubCommand);const command=match[1]||'';const childId=match[4]||'';const superCommand=command+(match[5]||'#');const superForm=(match[5]||'').substring(1);const childs=$(`[data-window="form-${command}"]`);const grandchild=$(`[data-window="form-${command}-${superForm}"]`);const setBackLink=elm=>{const btn=elm.find('[data-close-child]');if(btn.length){btn.attr('href',btn.data('close-child').replace('[id]',recId).replace('[childId]',childId?`:${childId}`:''))}};const showForm=(elm,name)=>{$(`[data-menu="form-${name}"]`).show();$(`[data-menu="form-${name}"] > a`).each(function(){const $this=$(this);$this.attr('href',$this.attr('data-href').replace('[id]',recId).replace('[childId]',childId?`:${childId}`:''))});forms.addClass('reduced');elm.addClass('active');setBackLink(elm)};this.permatab=!0;$('[data-menu="form"].hidable').hide();$('[data-save="form"]').hide();if(grandchild.length){$(`[data-menu="form-${command}"].hidable`).hide();showForm(grandchild,`${command}-${superCommand}`)}else if(childs.length){showForm(childs,command)}
if(typeof this.module.actions[command]==='function'){this.module.actions[command](childId)}
if(typeof this.module.actions[superCommand]==='function'){this.module.actions[superCommand](childId)}};const yabaTab=()=>{const firstTab=this.permatab?[]:$('#main-form .nav.nav-tabs').find('a[href^="#tab-"]:visible:first');if(!firstTab.length){this.permatab=!1;return}
$('#main-form .tab-pane table tbody').addClass('MR');firstTab.tab('show');const firstTable=$(firstTab.attr('href')).find('table.dataTable');if(firstTable.length){const dtable=firstTable.DataTable();const body=dtable.table().body();body.className='';dtable.draw()}};$('[data-menu="form"] > a').each(function(){const $this=$(this);$this.attr('href',$this.attr('data-href').replace('[id]',recId))});if(redraw){this.module.fillDetails()}
if(typeof this.module.formCommandsToggler==='function'){this.module.formCommandsToggler()}
if(recId&&method){recordCommand(method);return}
forms.removeClass('reduced');$('[data-save="form"]').show();yabaTab()},dataTablesObj:normalizeDTObj,htmlLink:aLinkString,iconBug:htmlIcon({className:iconBugClassName,title:'N/A'}),messageSituationIcon:messageSituationIcon,messageSituationText:messageSituationText,orderItemSituationIcon:orderItemSituationIcon,orderItemSituationText:orderItemSituationText,orderReferralIcon:orderReferralIcon,orderReferralText:orderReferralText,orderSituationIcon:orderSituationIcon,orderSituationText:orderSituationText,productSituationIcon:productSituationIcon,productSituationText:productSituationText,personUserHyperlink:personUserHyperlink,purchaseOrderSituationIcon:purchaseOrderSituationIcon,purchaseOrderSituationText:purchaseOrderSituationText,rowActions:rowActions,shippingOriginName:(cod)=>{return({0:'Cálculo legado',1:'Sistema dos Correios',2:'Arbitrado por falha no sistema dos Correios',3:'Tabela de fretes do produto',4:'Produto com frete grátis',6:'Cadastrado manualmente no orçamento',})[cod]||'Indefinido'},showConfirmDialog:showConfirmDialog,hideConfirmDialog:hideConfirmDialog,}}))